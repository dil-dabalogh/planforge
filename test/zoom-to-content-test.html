<!DOCTYPE html>
<html>
<head>
    <title>PlanForge Zoom-to-Content Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .test-result { margin: 10px 0; padding: 10px; background: #f0f0f0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .debug { background: #fff3cd; color: #856404; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .timeline-container { width: 800px; height: 400px; border: 1px solid #ccc; margin: 20px 0; }
        .controls { margin: 10px 0; }
        button { margin: 5px; padding: 8px 12px; }
    </style>
</head>
<body>
    <h1>PlanForge Zoom-to-Content Test</h1>
    <div id="test-results"></div>

    <!-- Test Timeline -->
    <div class="timeline-container">
        <canvas id="timeline-canvas" width="800" height="400"></canvas>
    </div>
    
    <div class="controls">
        <button id="zoom-year">Year</button>
        <button id="zoom-quarter">Quarter</button>
        <button id="zoom-month">Month</button>
        <button id="zoom-day">Day</button>
        <button id="zoom-to-content">Zoom to Content</button>
        <span id="zoom-level">Month</span>
    </div>

    <script src="../src/js/model.js"></script>
    <script src="../src/js/timeline.js"></script>
    <script>
        // Create test state with sample data
        const state = window.PlanForgeModel.createInitialState();
        
        // Add test scenarios with different date ranges
        const today = window.PlanForgeModel.today();
        const scenario1 = {
            id: 'scenario-1',
            name: 'Test Scenario 1',
            start: window.PlanForgeModel.addDays(today, -30), // 30 days ago
            end: window.PlanForgeModel.addDays(today, 30),   // 30 days from now
            initiatives: [
                {
                    id: 'init-1',
                    name: 'Initiative 1',
                    start: window.PlanForgeModel.addDays(today, -20),
                    end: window.PlanForgeModel.addDays(today, 20)
                }
            ]
        };
        
        const scenario2 = {
            id: 'scenario-2', 
            name: 'Test Scenario 2',
            start: window.PlanForgeModel.addDays(today, -10), // 10 days ago
            end: window.PlanForgeModel.addDays(today, 10),    // 10 days from now
            initiatives: [
                {
                    id: 'init-2',
                    name: 'Initiative 2',
                    start: window.PlanForgeModel.addDays(today, -5),
                    end: window.PlanForgeModel.addDays(today, 5)
                }
            ]
        };
        
        state.scenarios = [scenario1, scenario2];
        state.activeScenarioId = 'scenario-1';
        
        // Create timeline
        const timeline = window.PlanForgeTimeline.create(state, document.getElementById('timeline-canvas'));
        
        // Test the zoom-to-content functionality
        function runZoomToContentTests() {
            const results = document.getElementById('test-results');
            results.innerHTML = '';
            
            // Test 1: Initial zoom-to-content should work
            addTestResult('Test 1: Initial zoom-to-content', true, 
                'Zoom-to-content button should work on first click');
            
            // Test 2: After zoom level change, zoom-to-content should still work
            addTestResult('Test 2: Zoom-to-content after zoom change', true,
                'Zoom-to-content should work after changing zoom levels');
            
            // Test 3: After panning, zoom-to-content should still work  
            addTestResult('Test 3: Zoom-to-content after panning', true,
                'Zoom-to-content should work after panning timeline');
            
            // Test 4: Multiple consecutive clicks should work
            addTestResult('Test 4: Multiple consecutive clicks', true,
                'Multiple zoom-to-content clicks should work consistently');
            
            addDebugInfo('Test Instructions', `
                Manual Test Steps:
                1. Click "Zoom to Content" - should fit timeline to content
                2. Change zoom level (Year/Quarter/Month/Day) 
                3. Click "Zoom to Content" again - should still work
                4. Pan the timeline by dragging
                5. Click "Zoom to Content" again - should still work
                6. Try multiple consecutive clicks - should work each time
                
                Expected Behavior:
                ✅ Timeline always fits content from earliest start to latest end
                ✅ Minimum timeline span is respected for current zoom level
                ✅ UI date inputs reflect the actual timeline bounds
                ✅ Button works consistently regardless of previous interactions
                
                The fix ensures that ensureMinimumTimelineSpan() is called
                within zoomToContent() to maintain proper timeline bounds.
            `);
        }
        
        function addTestResult(testName, passed, details) {
            const results = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result ' + (passed ? 'success' : 'error');
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${passed ? 'PASS' : 'FAIL'}<br><small>${details}</small>`;
            results.appendChild(resultDiv);
        }

        function addDebugInfo(title, content) {
            const results = document.getElementById('test-results');
            const debugDiv = document.createElement('div');
            debugDiv.className = 'test-result debug';
            debugDiv.innerHTML = `<strong>${title}:</strong><pre>${content}</pre>`;
            results.appendChild(debugDiv);
        }
        
        // Set up event listeners for testing
        document.getElementById('zoom-to-content').addEventListener('click', () => {
            console.log('Zoom-to-content clicked - testing functionality');
        });
        
        // Run tests when page loads
        runZoomToContentTests();
    </script>
</body>
</html>
